# 3AI项目迁移工具

## 概述

这是一个专为3AI项目模板设计的自动化迁移工具，用于快速、可靠地创建新项目。当您从`{{PROJECT_ROOT}}`复制项目模板到新位置（如`S:\Stock`）后，运行此工具可以自动完成所有必要的初始化工作。

## 核心功能

### 🔍 项目结构验证
- 验证必需目录的完整性（bak、docs、logs、project、tools）
- 确保项目模板结构正确

### 🗂️ 运行时数据清理
- 清理logs目录下的所有日志文件
- 删除开发过程中的临时数据（memory.json、tasks.json）
- 清理历史备份文件（保留目录结构）

### ⚙️ 配置文件更新
- 自动更新`project_config.yaml`中的项目信息
- 重置`.env`文件为默认模板
- 更新时间戳信息

### 📝 文档模板重置
- 更新开发任务书中的项目名称
- 更新技术路线中的项目名称
- 更新项目架构设计中的项目名称

### 🧹 缓存文件清理
- 删除所有`__pycache__`目录
- 清理`.pyc`编译文件

### 📊 迁移报告生成
- 生成详细的迁移报告
- 记录所有操作步骤和结果

## 使用方法

### 基本使用流程

1. **复制模板项目**
   ```bash
   # 复制整个3AI目录到新位置
   xcopy /E /I "{{PROJECT_ROOT}}" "S:\Stock"
   ```

2. **进入新项目目录**
   ```bash
   cd S:\Stock
   ```

3. **运行迁移工具**
   ```bash
   # 基本使用（自动使用目录名称作为项目名称）
   python tools\项目迁移工具\startnew.py
   
   # 详细输出模式
   python tools\项目迁移工具\startnew.py --verbose
   ```

### 命令行选项

```bash
python tools\项目迁移工具\startnew.py [选项]

选项:
  --verbose, -v          显示详细输出信息
  --help, -h             显示帮助信息
```

### 使用示例

```bash
# 基本使用（自动使用根目录名称作为项目名称）
python tools\项目迁移工具\startnew.py

# 详细输出模式
python tools\项目迁移工具\startnew.py --verbose
```

## 迁移过程详解

### 第一步：项目结构验证
- 检查必需目录是否存在
- 验证工具脚本的完整性
- 确保在正确的目录中运行

### 第二步：创建备份
- 在`bak/迁移备份/`目录下创建时间戳备份
- 备份关键配置文件：
  - `docs/03-管理/project_config.yaml`
  - `docs/03-管理/.env`
  - `docs/02-开发/memory.json`
  - `docs/02-开发/tasks.json`

### 第三步：清理运行时数据
- **日志文件**：删除`logs/`目录下的所有`.log`、`.json`、`.txt`文件
- **开发数据**：删除`memory.json`和`tasks.json`
- **历史备份**：清理`bak/`目录下的旧备份文件

### 第四步：更新配置文件
- **project_config.yaml**：
  - 更新`project_name`字段
  - 更新`project_root`路径
  - 重置`created_at`和`last_updated`时间戳
- **.env文件**：从`.env.example`重置

### 第五步：重置文档模板
- **开发任务书**：更新项目名称和标题
- **技术路线**：更新项目名称和标题
- **项目架构设计**：更新项目名称和标题

### 第六步：清理缓存文件
- 删除所有`__pycache__`目录
- 删除所有`.pyc`文件

### 第七步：生成迁移报告
- 在`logs/`目录下生成详细的迁移报告
- 记录所有操作步骤和清理内容
- 提供下一步操作建议

## 输出示例

### 成功输出
```
============================================================
开始项目迁移流程
============================================================
验证项目结构...
项目结构验证通过
创建迁移备份...
备份: docs/03-管理/project_config.yaml
清理运行时数据...
删除日志: app.log
删除开发数据: docs/02-开发/memory.json
更新项目配置...
更新project_config.yaml完成
重置文档模板...
更新开发任务书
清理缓存文件...
删除缓存目录: tools/__pycache__
生成迁移报告...
迁移报告已生成: logs/项目迁移报告_20250120_143022.md
============================================================
项目迁移完成！
新项目名称: Stock
项目根目录: S:\Stock
============================================================

🎉 项目迁移成功完成！
新项目已准备就绪: Stock

建议下一步操作:
1. 检查并完善 docs/01-设计/开发任务书.md
2. 制定具体的 docs/01-设计/技术路线.md
3. 配置 docs/03-管理/.env 环境变量
4. 开始项目开发工作
```

## 注意事项

### ⚠️ 重要提醒

1. **运行位置**：必须在新项目的根目录下运行此脚本
2. **备份安全**：工具会自动创建备份，但建议手动备份重要数据
3. **权限要求**：确保对项目目录有读写权限
4. **Python环境**：需要Python 3.6+和PyYAML库

### 🔧 依赖要求

```bash
# 安装必需的Python包
pip install pyyaml
```

### 📁 目录结构要求

运行前确保项目具有以下基本结构：
```
项目根目录/
├── bak/                    # 备份目录
├── docs/                   # 文档目录
│   ├── 01-设计/
│   ├── 02-开发/
│   └── 03-管理/
├── logs/                   # 日志目录
├── project/                # 项目代码目录
└── tools/                  # 工具目录
    └── 项目迁移工具/
        ├── startnew.py     # 迁移脚本
        └── README.md       # 说明文档
```

## 故障排除

### 常见问题

**Q: 提示"请在项目根目录下运行此脚本"**
- A: 确保在包含`tools`目录的项目根目录下运行

**Q: 提示"缺少必需目录"**
- A: 检查项目模板是否完整复制，确保包含所有必需目录

**Q: 配置文件更新失败**
- A: 检查文件权限，确保对配置文件有写入权限

**Q: 导入模块失败**
- A: 工具会自动降级到基础功能，不影响核心迁移流程

### 日志文件

详细的运行日志保存在：
- `logs/项目迁移.log` - 运行日志
- `logs/项目迁移报告_[时间戳].md` - 迁移报告

## 版本信息

- **版本**: 1.0
- **作者**: 雨俊
- **更新日期**: 2025-01-20
- **兼容性**: Python 3.6+

## 技术支持

如遇到问题，请检查：
1. 日志文件中的错误信息
2. 项目目录结构是否完整
3. Python环境和依赖包是否正确安装

---

*此工具是3AI项目管理体系的重要组成部分，旨在提供高效、可靠的项目初始化解决方案。*