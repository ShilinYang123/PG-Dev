# 仔细、仔细、再仔细，严谨、严谨、再严谨

---

# PMC智能追踪系统项目规范与流程

本文档基于《项目架构设计.md》制定，旨在明确PMC智能追踪系统开发过程中的各项标准与流程，确保开发工作有序、高效进行，提升项目的可维护性与协作性。

## 项目概述

PMC智能追踪系统是一个AI Agent驱动的生产管理平台，专注于小家电行业的计划排程、预警提醒和闭环跟踪。通过智能化算法和多模态交互，实现生产过程的自动化管理。

## 目录

### 核心管理规范
1. [开发角色与工具使用规则](#一开发角色与工具使用规则) - 明确角色定义、对话规范、工具使用要求
2. [权限管理规定](#二权限管理规定) - 核心文档操作权限、核心脚本保护权限、目录结构管理权限
3. [工作前准备流程](#三工作前准备流程) - 任务目标、技术路径、环境检查等5个步骤
4. [工作结束事项](#四工作结束事项) - 代码检查、测试、提交、文档更新等8项要求
5. [GitHub仓库结构规范](#五github仓库结构规范) - 仓库组织和提交规范
6. [目录文件及清单管理规定](#六目录文件及清单管理规定) - 目录结构标准和管理工具使用
7. [命名规范](#七命名规范) - 通用原则和各类元素的具体命名规则

### 技术开发规范
8. [开发流程规范](#八开发流程规范) - Git工作流程、分支管理、提交规范、代码审查
9. [开发环境规范](#九开发环境规范) - 环境要求、编辑器配置、依赖管理
10. [代码规范](#十代码规范) - 命名规范、代码风格、注释规范（Python）
11. [测试规范](#十一测试规范) - 测试策略、覆盖率要求、测试用例结构
12. [配置管理规范](#十二配置管理规范) - 配置体系架构、环境管理、配置验证
13. [API设计规范](#十三api设计规范) - RESTful设计、版本控制、认证授权、监控日志

## 第一章 开发角色与工具使用规则

### 1. 角色定义

*   **杨老师**：编程基础薄弱，非专业技术人员，负责提出项目需求。
*   **雨俊**：资深软件专家，担任项目技术负责人，负责项目实施计划制定、开发执行及测试工作 。

### 2. 对话规范

与杨老师沟通时，每次对话开头需以 "杨老师" 称呼。（本条以实时检测Agent是否遗忘规则）

### 3. 工具使用要求

| 工具名称                  | 功能用途                      |
| -------------------------- | ------------------------------ |
| TaskManager           | 任务分解，将复杂任务拆解为可执行子任务       |
| sequential - thinking | 辅助逻辑推理，理清开发思路与流程          |
| context7              | 查询技术与知识文档，获取开发所需资料        |
| memory                | 增强项目内容记忆与理解，便于快速调用相关信息    |
| flake8                | 梳理并修正代码错误，保证代码质量          |
| desktop - commander   | 自动执行终端命令操作，提高开发效率         |
|                            | 秉持 YOLO 模式精神，主动、自动化执行各项任务 |

### 4. 工作流程规范

*   当对话上下文长度接近系统限制时，及时将重要内容存入 memory。
*   每日工作结束，严格执行自检流程，列举当日工作内容并对照项目规范检查。

### 5. 文档命名规则

所有文档统一使用中文命名，确保名称清晰表意。

### 6. 代码验证要求

每次完成或修改代码后，自行运行代码，并使用 flake8、eslint、playwright 等工具检测验证，确保代码质量达标。

## 第二章 文件权限管理规范

### 1. 核心文件权限控制原则

以下核心文档必须设置为只读状态，修改需要获得杨老师的明确授权：

**设计文档类（🔒 只读）：**
- `docs\01-设计\开发任务书.md` - 需要杨老师授权
- `docs\01-设计\技术方案.md` - 需要杨老师授权
- `docs\01-设计\项目架构设计.md` - 需要杨老师授权
- `docs\01-设计\目录结构标准清单.md` - 需要杨老师授权。
在杨老师授权同意后，用`tools\update_structure.py`生成，范围为"{{paths.root}}\"全部内容，其中：
（1）`\bak\`下只包括`\bak\github_repo`、`\bak\迁移备份`、`\bak\专项备份`、`\bak\待清理资料`、`\bak\常规备份` 5个子目录名，排除其所有具体备份文件；
（2）`\logs\`下只包括`\logs\工作记录`、`\logs\检查报告`、`\logs\其他日志`、`\logs\archive` 4个子目录名，排除其所有具体记录文件。

**管理规范类（🔒 只读）：**
- `docs\03-管理\规范与流程.md` - 需要杨老师授权
- `docs\03-管理\project_config.yaml` - 需要杨老师授权
- `docs\03-管理\.env` - 需要杨老师授权
- `docs\03-管理\.env.example` - 需要杨老师授权

**核心工具脚本（🔒 只读）：**
- `tools\finish.py` - 需要杨老师授权
- `tools\control.py` - 需要杨老师授权
- `tools\check_structure.py` - 目录结构合规性检查脚本- 必须经杨老师授权才能修改
- `tools\update_structure.py` - 合规的《目录结构标准清单.md》 生成脚本- 必须经杨老师授权才能修改

### 2. 权限控制原则

*   **最小权限原则**：仅在必要时申请和使用相应权限；
*   **审批记录**：所有权限申请和批准过程需要有明确记录；
*   **责任追溯**：确保每个操作都有明确的责任人和授权依据；
*   **权限状态管理**：核心文件默认保持只读状态，仅在获得授权后临时解锁。

### 3. 权限控制脚本使用

**工具路径**：`tools\control.py`

**使用场景**：
*   需要修改核心文档或脚本文件时；
*   工作结束后恢复文件只读保护状态时；
*   检查当前文件权限状态时。

**操作流程**：
1. 获得杨老师明确授权后，运行 `python tools\control.py`
2. 选择相应操作（设置只读\可写\检查状态）
3. 脚本会自动备份文件到 `bak\专项备份\` 目录，取名"权限变更备份"加时间戳
4. 完成必要修改后，及时恢复文件只读状态

## 第三章 工作准备流程

### 1. 明确任务目标

*   仔细研读 "{{paths.docs_dir}}\01-设计\开发任务书.md"。
*   结合当前任务看板，精准把握本次工作核心目标和交付成果。

### 2. 规划技术路径

*   参考 "{{paths.docs_dir}}\01-设计\技术方案.md"。
*   基于项目现有技术架构，制定详细技术实施方案与步骤。

### 3. 检查开发环境

#### （1）本地环境配置

*   确认 VS Code Dev Container、Docker 服务等已正确配置且运行正常。
*   检查并安装项目所需相关依赖组件，确保开发环境完整。

#### （2）MCP 工具检查

*   测试 desktop - commander、sequential - thinking、TaskManager、memory 等工具可用性。
*   数据存储路径禁止通过编码设置，而是通过配置文件及变量文件设置为：
    *   TaskManager 存储路径："项目根目录 \docs\02 - 开发 \tasks.json"
*   memory 存储路径："项目根目录 \docs\02 - 开发 \memory.json"

#### （3）代码辅助工具

检查 flake8、eslint 等代码检查工具能否正常使用，保障代码检查工作顺利开展。

### 4. 同步最新代码

**Git仓库目录**：`{{PROJECT_ROOT}}\bak\github_repo`

从代码仓库拉取最新代码，避免基于过旧版本开发，确保开发内容时效性。

### 5. 回顾相关文档

查阅与任务相关设计文档、API 文档、模块说明等，充分了解项目背景与技术细节，为开发工作奠定基础。

## 四、工作结束事项

### 1. 代码质量检查

运行 flake8、eslint 等代码质量检查工具，记录检查结果并及时修复问题，保证代码质量达标。

### 2. 自动化测试

执行单元测试和集成测试，确保测试覆盖率满足项目要求，验证系统功能稳定性与可靠性。

### 3. 功能自测

对完成功能进行基本自测，对照需求规格验证功能是否正确实现，及时发现并解决功能缺陷。

### 4. 代码提交

将当日完成或有进展的代码全部提交到 Git 仓库`{{PROJECT_ROOT}}\bak\github_repo`，遵循提交规范，编写清晰、准确提交说明，方便后续追溯与协作。

### 5. 文档更新

更新开发日志、技术方案、目录结构标准清单等关键文档，确保文档与代码实现同步，为项目维护与后续开发提供准确资料。

### 6. 更新任务状态

在看板或任务管理工具中及时更新任务状态，标注任务进度与完成情况，便于团队成员了解项目整体进展。

### 7. 运行自检脚本

执行`finish.py` `--self - check`脚本进行工作结束自检，按脚本提示处理检查结果，确保工作完整性与规范性。

### 8. 目录结构合规性检查

每次工作结束时，由`finish.py`脚本执行以下操作：

{{ PROJECT_ROOT }}/project
2.  自动生成含违规项的检查报告。
    *   报告生成位置：`{{paths.logs_dir}}\{{structure_check.report_dir}}\`
    *   报告命名格式：`检查报告_YYYYMMDD - HHMMSS.md`

3.  调用`agent_verify_structure`函数暂停脚本执行；

4.  通过 TaskManager 创建审批任务；

5.  人工处理违规项后，若项目结构发生变更，再次运行`update_structure.py`更新目录结构标准清单。

## 五、GitHub 仓库结构规范

### 1. 仓库主要文件夹

*   `\docs`：存放项目相关文档，包括设计文档、用户手册等。
*   `\project`：存放项目代码，按功能模块或技术架构组织。
*   `\tools`：存放项目开发过程中使用的工具脚本。

### 2. 提交规范

*   所有代码提交和版本控制遵循上述仓库结构规范，保证项目文件组织清晰、层次分明。
*   本地`\bak`和`\logs`目录内容不得推送到 Git 仓库，确保仓库内容规范性。

### 3. bak和logs目录特殊处理规范

#### 3.1 目录结构管理
*   **bak目录**：必须保持标准子目录结构（github_repo/、专项备份/、迁移备份/、待清理资料/、常规备份/），但具体文件内容不纳入版本控制
*   **logs目录**：必须保持标准子目录结构（archive/、其他日志/、工作记录/、检查报告/），但具体文件内容不纳入版本控制

#### 3.2 版本控制规则
*   Git提交时：只提交目录结构，排除所有具体文件内容
*   GitHub推送时：只推送目录结构，排除所有具体文件内容
*   系统全量备份时：只备份目录结构，排除所有具体文件内容

#### 3.3 .gitignore配置要求
**重要提醒**：.gitignore文件必须放置在 `{{paths.backup_dir}}\github_repo\.gitignore` 位置，不得放在项目根目录下。

确保该.gitignore文件包含以下规则：
```
# 排除bak目录的具体文件，保留目录结构
bak\**\*
!bak\
!bak\github_repo\
!bak\专项备份\
!bak\迁移备份\
!bak\待清理资料\

# 排除logs目录的具体文件，保留目录结构
logs/**/*
!logs/
!logs/archive/
!logs/其他日志/
!logs/工作记录/
!logs/检查报告/

```

## 六、目录文件及清单管理规定

### 1. 目录结构标准清单

*   存放位置：`{{paths.docs_dir}}\01-设计\{{structure_check.standard_list_file}}`
*   清单涵盖内容：
    *   `\bak`文件夹及其子文件夹（共 4 个），不包含具体文件；
    *   `\logs`文件夹，不包含具体文件；
    *   `\docs`文件夹及其所有内容；
    *   `\project`文件夹及其所有内容；
    *   `\tools`文件夹及其所有内容。

### 2. 特殊目录管理

*   **\bak 目录**：用于本地备份，其下子文件夹（如 "github_repo"、"迁移备份"、"专项备份"、"待清理资料" 和 "常规备份"）仅保留在本地，不推送到 Git 仓库。
*   **\bak\github_repo 目录**：专门用于 Git 仓库，包含`docs`、`project`和`tools`三个子文件夹，需符合 GitHub 仓库结构规范。
*   **\logs 目录**：用于存放日志文件，内容不包含在目录结构标准清单中，也不推送到 Git 仓库。

### 3. 目录结构更新工具

`update_structure.py`使用规范：
*   在生成目录结构标准清单时，自动排除`\bak`和`\logs`目录内容；
*   仅保留目录本身，不包含具体文件，工具已配置好相关排除规则。

## 七、命名规范

### 1. 通用原则

*   **清晰性**：命名清晰表达元素含义或用途，避免模糊或过于简略缩写。
*   **一致性**：整个项目中，同类元素命名风格保持统一。
*   **简洁性**：在保证清晰表意前提下，命名尽量简洁。
*   **英文为主**：代码中的标识符（变量、函数、类、文件名、目录名等）原则上使用英文，特定配置文件或文档明确要求使用中文的情况除外。

### 2. 具体命名规则

| 元素类型                           | 命名规范                                               | 示例                                          |
| ----------------------------------- | ------------------------------------------------------- | ------------------------------------------------ |
| 目录                             | 小写字母和下划线（snake_case）；层级或分类目录可用短横线（kebab - case）分隔 | src、utils、01 - 设计                           |
| 代码文件（Python）                   | 小写字母和下划线（snake_case）                              | data_loader.py、api_service.py             |
| 文档文件（Markdown）                 | 中文命名，用下划线或短横线分隔                                    | 项目架构设计.md、数据库 ER 图.md                       |
| 配置文件                           | 小写字母，可包含点（.）和下划线（_）                               | .env、config.yaml、settings_production.py    |
| 变量（Python）                     | 小写字母和下划线（snake_case）                              | user_name、total_count                     |
| 常量                             | 全大写字母和下划线                                          | MAX_RETRIES、DEFAULT_TIMEOUT               |
| 函数 / 方法（Python）                | 小写字母和下划线（snake_case）                              | get_user_data()、calculate_total_price() |
| 类（Python）                      | 大驼峰式（PascalCase）                                   | UserService、DatabaseConnection              |
| 数据库表名和字段名                      | 小写字母和下划线（snake_case）                              | users（表名）、user_id、created_at（字段名）         |

### 3. 注意事项

*   本规范为通用指导，若特定框架或库有自身命名约定，优先遵循其规定。

## 八、开发流程规范

### 三阶段开发计划

根据项目架构设计，开发工作分为三个阶段：

#### 第一阶段：基础版开发（1个月）
**目标**：实现自动生产排程和微信提醒功能
**交付物**：
- 核心算法开发
- 基础数据模型设计
- 简单排程逻辑
- 微信API集成
- 基础UI界面

#### 第二阶段：增强版开发（2个月）
**目标**：添加多模态提醒和闭环确认机制
**交付物**：
- 多模态提醒模块
- 闭环确认系统
- 数据集成优化
- 性能测试和优化
- 用户反馈集成

#### 第三阶段：智能版开发（3个月）
**目标**：集成AI优化和硬件联动
**交付物**：
- AI预测引擎
- 遗传算法优化
- IoT硬件集成
- 全面测试和部署
- 完整文档和培训材料

### Git 工作流程

#### 分支管理
- `main`: 主分支，保持稳定可发布状态
- `develop`: 开发分支，集成最新开发功能
- `feature/*`: 功能分支，开发新功能
- `hotfix/*`: 热修复分支，紧急修复生产问题
- `release/*`: 发布分支，准备新版本发布

#### 提交规范
```
<type>(<scope>): <subject>

<body>

<footer>
```

**类型说明**:
- `feat`: 新功能
- `fix`: 修复bug
- `docs`: 文档更新
- `style`: 代码格式调整
- `refactor`: 代码重构
- `test`: 测试相关
- `chore`: 构建过程或辅助工具变动

**示例**:
```
feat(scheduling): 添加自动排程功能

- 实现LSTM预测算法
- 集成遗传优化
- 添加实时监控

Closes #123
```

### 代码审查

#### 审查要点
- 代码逻辑正确性
- 代码风格一致性
- 性能影响评估
- 安全性检查
- 测试覆盖率

#### 审查流程
1. 开发者创建Pull Request
2. 自动化检查（CI/CD）
3. 同行代码审查
4. 技术负责人最终审查
5. 合并到目标分支

## 九、开发环境规范

### 环境要求

#### 基础环境
- Python >= 3.9 (项目主要开发语言)
- Node.js >= 16.0.0 (前端开发支持)
- Docker >= 20.0 (容器化开发)
- Git >= 2.30 (版本控制)
- Windows 10/11 (目标运行环境)

#### 数据存储环境
- MySQL >= 8.0
- MongoDB >= 5.0
- Redis >= 6.0 (缓存)

#### AI环境
- TensorFlow/PyTorch
- CUDA支持 (可选GPU加速)

#### 开发工具
- VS Code + Dev Container支持
- Docker Desktop
- Python虚拟环境管理

### 编辑器配置

#### VS Code 推荐插件
```json
{
  "recommendations": [
    "esbenp.prettier-vscode",
    "ms-python.python",
    "ms-vscode.vscode-typescript-next",
    "bradlc.vscode-tailwindcss",
    "ms-vscode-remote.remote-containers"
  ]
}
```

#### EditorConfig
```ini
root = true

[*]
charset = utf-8
end_of_line = lf
insert_final_newline = true
trim_trailing_whitespace = true
indent_style = space
indent_size = 4

[*.md]
trim_trailing_whitespace = false
```

### 依赖管理

#### Node.js项目
- 使用 `package-lock.json` 锁定依赖版本
- 定期更新依赖，检查安全漏洞
- 区分 `dependencies` 和 `devDependencies`

#### Python项目
- 使用 `requirements.txt` 管理依赖
- 使用虚拟环境隔离项目依赖
- 固定依赖版本号
- 集成AI框架依赖

#### 代码质量工具配置
- **flake8**: Python代码风格检查
- **black**: Python代码格式化
- **mypy**: Python类型检查
- **pytest**: Python单元测试框架
- **coverage**: 测试覆盖率分析
- **bandit**: Python安全性检查

## 十、代码规范

### 命名规范

#### 变量命名
```python
# Python - snake_case
user_name = "张三"
total_count = 100
is_active = True
```

#### 函数命名
```python
# Python
def get_user_info(user_id):
    pass

def calculate_total_price(items):
    pass
```

### 代码风格

遵循PEP8标准，使用Black自动格式化。

### 注释规范

- 函数/类: Docstring格式
- 行内注释: 解释复杂逻辑
- TODO注释: 标记待办事项

## 十一、测试规范

### 测试策略

- 单元测试: 覆盖核心函数
- 集成测试: 测试模块交互
- 系统测试: 端到端流程
- 性能测试: 排程算法效率

### 覆盖率要求

- 整体覆盖率 > 80%
- 核心模块 > 90%

### 测试用例结构

使用pytest框架，组织为setup/teardown。

## 十二、配置管理规范

### 配置体系架构

- .env: 环境变量
- config.yaml: 应用配置
- 数据库配置分离

### 环境管理

- development
- testing
- production

### 配置验证

启动时自动验证配置完整性。

## 十三、API设计规范

### RESTful设计

- 使用HTTP方法: GET/POST/PUT/DELETE
- 资源导向URL

### 版本控制

- /api/v1/...

### 认证授权

- JWT token
- 角色基于访问控制

### 监控日志

- 记录所有API调用
- 错误追踪
